<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lee Hopkins — Training OS</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<div class="app">

  <nav class="sidebar">
    <div class="sidebar-brand">
      <span class="brand-initials">LH</span>
      <span class="brand-text">Training<br>OS</span>
    </div>
    <ul class="nav-links">
      <li class="nav-item active"><a href="index.html"><span class="nav-icon">◈</span><span>Overview</span></a></li>
      <li class="nav-item"><a href="cycling.html"><span class="nav-icon">⬡</span><span>Cycling</span></a></li>
      <li class="nav-item"><a href="running.html"><span class="nav-icon">▷</span><span>Running</span></a></li>
      <li class="nav-item"><a href="rowing.html"><span class="nav-icon">⊕</span><span>Rowing</span></a></li>
      <li class="nav-item"><a href="cardio.html"><span class="nav-icon">◎</span><span>Cardio</span></a></li>
      <li class="nav-item"><a href="other.html"><span class="nav-icon">○</span><span>Other</span></a></li>
    </ul>
    <div class="sidebar-footer">
      <div class="sync-status">
        <span class="sync-dot"></span>
        <span class="sync-text" id="last-sync">Loading...</span>
      </div>
    </div>
  </nav>

  <main class="main-content">

    <header class="page-header">
      <div class="header-left">
        <h1 class="page-title">Overview</h1>
        <span class="page-subtitle" id="page-subtitle">—</span>
      </div>
      <div class="header-right">
        <div>
          <div class="year-totals">
            <div class="year-stat"><span class="year-stat-value" id="ytd-distance">—</span><span class="year-stat-label">km YTD</span></div>
            <div class="year-stat"><span class="year-stat-value" id="ytd-hours">—</span><span class="year-stat-label">hrs YTD</span></div>
            <div class="year-stat"><span class="year-stat-value" id="ytd-tss">—</span><span class="year-stat-label">TSS YTD</span></div>
          </div>
          <div class="ytd-breakdown">
            <div class="ytd-sport cycling">
              <span class="ytd-sport-label">⬡ Cycling</span>
              <div class="ytd-sport-stats">
                <div class="ytd-mini"><span class="ytd-mini-val" id="ytd-cy-dist">—</span><span class="ytd-mini-lbl">km</span></div>
                <div class="ytd-mini"><span class="ytd-mini-val" id="ytd-cy-hrs">—</span><span class="ytd-mini-lbl">hrs</span></div>
                <div class="ytd-mini"><span class="ytd-mini-val" id="ytd-cy-tss">—</span><span class="ytd-mini-lbl">TSS</span></div>
              </div>
            </div>
            <div class="ytd-sport running">
              <span class="ytd-sport-label">▷ Running</span>
              <div class="ytd-sport-stats">
                <div class="ytd-mini"><span class="ytd-mini-val" id="ytd-ru-dist">—</span><span class="ytd-mini-lbl">km</span></div>
                <div class="ytd-mini"><span class="ytd-mini-val" id="ytd-ru-hrs">—</span><span class="ytd-mini-lbl">hrs</span></div>
                <div class="ytd-mini"><span class="ytd-mini-val" id="ytd-ru-tss">—</span><span class="ytd-mini-lbl">TSS</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div id="loading-state" class="loading-overlay">
      <div class="loading-spinner"></div>
      <span id="loading-msg">Loading dashboard data...</span>
    </div>

    <div id="error-state" class="error-state hidden">
      <strong>No data found.</strong> <span id="error-msg"></span>
    </div>

    <div id="dashboard-content" class="hidden">

      <section class="metrics-row">
        <div class="metric-card fitness">
          <div class="metric-label">Fitness</div>
          <div class="metric-value metric-accent" id="ctl-value">—</div>
          <div class="metric-delta" id="ctl-delta">—</div>
          <div class="metric-bar"><div class="metric-bar-fill" id="ctl-bar" style="width:0%"></div></div>
          <div class="metric-sub">Chronic Training Load</div>
        </div>
        <div class="metric-card fatigue">
          <div class="metric-label">Fatigue</div>
          <div class="metric-value metric-orange" id="atl-value">—</div>
          <div class="metric-delta" id="atl-delta">ATL</div>
          <div class="metric-bar"><div class="metric-bar-fill" id="atl-bar" style="width:0%"></div></div>
          <div class="metric-sub">Acute Training Load</div>
        </div>
        <div class="metric-card form">
          <div class="metric-label">Form</div>
          <div class="metric-value metric-green" id="tsb-value">—</div>
          <div class="metric-delta" id="tsb-delta">—</div>
          <div class="metric-bar"><div class="metric-bar-fill" id="tsb-bar" style="width:50%"></div></div>
          <div class="metric-sub">Training Stress Balance</div>
        </div>
        <div class="metric-card hrv-card">
          <div class="metric-label">HRV</div>
          <div class="metric-value metric-purple" id="hrv-value">—</div>
          <div class="metric-delta neutral">ms</div>
          <div class="metric-bar"><div class="metric-bar-fill" id="hrv-bar" style="width:0%"></div></div>
          <div class="metric-sub">Resting HR: <span id="rhr-value">—</span> bpm</div>
        </div>
        <div class="metric-card sleep-card">
          <div class="metric-label">Sleep</div>
          <div class="metric-value metric-yellow" id="sleep-value">—</div>
          <div class="metric-delta neutral">hrs last night</div>
          <div class="metric-bar"><div class="metric-bar-fill" id="sleep-bar" style="width:0%"></div></div>
          <div class="metric-sub">Weight: <span id="weight-value">—</span> kg</div>
        </div>
        <div class="metric-card fitness">
          <div class="metric-label">W'bal</div>
          <div class="metric-value metric-accent" id="wbal-value">—</div>
          <div class="metric-delta neutral">kJ anaerobic reserve</div>
          <div class="metric-bar"><div class="metric-bar-fill" id="wbal-bar" style="width:0%"></div></div>
          <div class="metric-sub">FTP: <span id="ftp-value">—</span> W</div>
        </div>
      </section>

      <section class="charts-row two-one">
        <div class="chart-card">
          <div class="chart-header">
            <span class="chart-title">Fitness Trend — CTL / ATL / TSB</span>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
              <div class="chart-legend">
                <span class="legend-item ctl">CTL</span>
                <span class="legend-item atl">ATL</span>
                <span class="legend-item tsb">TSB</span>
              </div>
              <div class="toggle-group">
                <button class="toggle-btn active" data-fitness-toggle="42">42d</button>
                <button class="toggle-btn" data-fitness-toggle="365">365d</button>
              </div>
            </div>
          </div>
          <div class="chart-wrap tall"><canvas id="fitnessChart"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="chart-header">
            <span class="chart-title">Weekly TSS</span>
            <div class="chart-legend">
              <span class="legend-item ride">Ride</span>
              <span class="legend-item run">Run</span>
              <span class="legend-item row-l">Row</span>
            </div>
          </div>
          <div class="chart-wrap tall"><canvas id="tssChart"></canvas></div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title">Last 7 Days</h2>
          <span class="section-meta" id="week-summary">—</span>
        </div>
        <div class="activity-cards" id="activity-cards"></div>
      </section>

      <section class="charts-row full">
        <div class="chart-card">
          <div class="chart-header">
            <span class="chart-title">HRV & Sleep</span>
            <div style="display:flex;gap:10px;align-items:center">
              <div class="chart-legend">
                <span class="legend-item hrv-l">HRV</span>
                <span class="legend-item sleep-l">Sleep</span>
              </div>
              <div class="toggle-group">
                <button class="toggle-btn active" data-wellness-toggle="42">42d</button>
                <button class="toggle-btn" data-wellness-toggle="365">365d</button>
              </div>
            </div>
          </div>
          <div class="chart-wrap"><canvas id="hrvSleepChart"></canvas></div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title">Calendar</h2>
          <span class="section-meta">Last 4 weeks · by date</span>
        </div>
        <div class="calendar-wrap" id="calendar-wrap"></div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title">Activity Heatmap</h2>
          <div class="toggle-group">
            <button class="toggle-btn active" data-heatmap-toggle="1y">1 Year</button>
            
          </div>
        </div>
        <div class="heatmap-wrap" id="heatmap-wrap">
          <div id="heatmap-inner"></div>
          <div class="heatmap-legend">
            <span class="heatmap-legend-label">Less</span>
            <div class="heatmap-legend-cells">
              <div class="heatmap-legend-cell" style="background:var(--bg-elevated)"></div>
              <div class="heatmap-legend-cell" style="background:rgba(0,229,255,0.12)"></div>
              <div class="heatmap-legend-cell" style="background:rgba(0,229,255,0.28)"></div>
              <div class="heatmap-legend-cell" style="background:rgba(0,229,255,0.48)"></div>
              <div class="heatmap-legend-cell" style="background:rgba(0,229,255,0.68)"></div>
              <div class="heatmap-legend-cell" style="background:rgba(0,229,255,0.92)"></div>
            </div>
            <span class="heatmap-legend-label">More</span>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title">90-Day Bests</h2>
          <div class="tab-group">
            <button class="tab active" data-tab="cycling-bests">Cycling Power</button>
            <button class="tab" data-tab="running-bests">Running Pace</button>
          </div>
        </div>
        <div class="bests-container" id="cycling-bests">
          <div class="bests-chart-wrap"><canvas id="powerBestsChart"></canvas></div>
          <div class="bests-grid" id="power-bests-grid"></div>
        </div>
        <div class="bests-container hidden" id="running-bests">
          <div class="bests-chart-wrap"><canvas id="paceBestsChart"></canvas></div>
          <div class="bests-grid" id="pace-bests-grid"></div>
        </div>
      </section>

      <p class="garmin-note">Charts may include data from Garmin devices</p>

    </div>
  </main>
</div>

<script src="assets/js/charts.js"></script>
<script src="assets/js/data-loader.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const { activities, wellness, weeklyTSS, ytd, heatmap1y, athlete, meta } = await DATA.loadAll();

    // Sync time
    const updated = new Date(meta.last_updated);
    document.getElementById('last-sync').textContent = 'Updated ' + updated.toLocaleDateString('en-GB', { day:'numeric', month:'short', hour:'2-digit', minute:'2-digit' });

    // Page subtitle
    const weekNum = getISOWeekNum(new Date());
    document.getElementById('page-subtitle').textContent = `${new Date().getFullYear()} · Week ${weekNum}`;

    // ---- METRICS ----
const lw = DATA.latestWellness(wellness);

document.getElementById('ctl-value').textContent = lw.ctl?.toFixed(1) ?? '—';
document.getElementById('atl-value').textContent = lw.atl?.toFixed(1) ?? '—';

// Prefer Intervals TSB, fallback to local calculation
let tsbValue = null;

if (lw.tsb != null) {
  tsbValue = lw.tsb; // preferred: Intervals value
} else if (lw.ctl != null && lw.atl != null) {
  tsbValue = lw.ctl - lw.atl; // fallback: local calculation
}

document.getElementById('tsb-value').textContent =
  tsbValue != null
    ? (tsbValue >= 0 ? '+' : '') + tsbValue.toFixed(1)
    : '—';

document.getElementById('hrv-value').textContent   = lw.hrv ?? '—';
document.getElementById('rhr-value').textContent   = lw.resting_hr ?? '—';
document.getElementById('sleep-value').textContent = lw.sleep ?? '—';

const weight = athlete?.weight ?? lw.weight;
document.getElementById('weight-value').textContent =
  weight ? weight.toFixed(1) : '—';

if (athlete?.w_prime) {
  const wbalEl = document.getElementById('wbal-value');
  const wbalBar = document.getElementById('wbal-bar');
  if (wbalEl) wbalEl.textContent = Math.round(athlete.w_prime / 1000);
  if (wbalBar) wbalBar.style.width =
    Math.min(100, (athlete.w_prime / 30000) * 100) + '%';
}

if (athlete?.ftp) {
  const ftpEl = document.getElementById('ftp-value');
  if (ftpEl) ftpEl.textContent = athlete.ftp;
}

const setBar = (id, val, max) => {
  const el = document.getElementById(id);
  if (el && val) el.style.width =
    Math.min(100, (val / max) * 100) + '%';
};

setBar('ctl-bar', lw.ctl, 120);
setBar('atl-bar', lw.atl, 120);
setBar('hrv-bar', lw.hrv, 100);
setBar('sleep-bar', lw.sleep, 10);

// CTL delta
const ctlDelta = document.getElementById('ctl-delta');
const prevCtl = [...wellness].reverse().slice(7).find(w => w.ctl != null);

if (lw.ctl && prevCtl) {
  const diff = (lw.ctl - prevCtl.ctl).toFixed(1);
  ctlDelta.textContent =
    (diff > 0 ? '+' : '') + diff + ' this week';
  ctlDelta.className =
    'metric-delta ' + (diff >= 0 ? 'positive' : 'negative');
}

// TSB status (use same tsbValue logic)
const tsbEl = document.getElementById('tsb-delta');

if (tsbValue != null) {
  tsbEl.textContent =
    tsbValue > 10 ? 'Fresh · Ready to race' :
    tsbValue > 0  ? 'Fresh · Ready to train' :
    tsbValue > -10 ? 'Slight fatigue' :
    'Fatigued';

  tsbEl.className =
    'metric-delta ' + (tsbValue >= 0 ? 'positive' : 'negative');
}

    const tsbEl = document.getElementById('tsb-delta');
    if (lw.tsb != null) {
      tsbEl.textContent = lw.tsb > 10 ? 'Fresh · Ready to race' : lw.tsb > 0 ? 'Fresh · Ready to train' : lw.tsb > -10 ? 'Slight fatigue' : 'Fatigued';
      tsbEl.className = 'metric-delta ' + (lw.tsb >= 0 ? 'positive' : 'negative');
    }

    // ---- YTD ----
    document.getElementById('ytd-distance').textContent = ytd.total.distance.toLocaleString();
    document.getElementById('ytd-hours').textContent    = ytd.total.hours.toFixed(1);
    document.getElementById('ytd-tss').textContent      = ytd.total.tss.toLocaleString();
    document.getElementById('ytd-cy-dist').textContent  = ytd.cycling.distance.toLocaleString();
    document.getElementById('ytd-cy-hrs').textContent   = ytd.cycling.hours.toFixed(1);
    document.getElementById('ytd-cy-tss').textContent   = ytd.cycling.tss.toLocaleString();
    document.getElementById('ytd-ru-dist').textContent  = ytd.running.distance.toLocaleString();
    document.getElementById('ytd-ru-hrs').textContent   = ytd.running.hours.toFixed(1);
    document.getElementById('ytd-ru-tss').textContent   = ytd.running.tss.toLocaleString();

    // ---- FITNESS CHART ----
    const fitnessTrend = wellness.filter(w => w.ctl != null);
    const pbs = DATA.pbMarkers(activities, wellness);
    setupFitnessToggle('fitnessChart', fitnessTrend, pbs);

    // ---- TSS CHART ----
    buildTSSChart('tssChart', weeklyTSS);

    // ---- ACTIVITY CARDS ----
    const last7 = DATA.recentActivities(activities, 7);
    renderActivityCards(last7);

    // ---- HRV + SLEEP ----
    setupHRVSleepToggle('hrvSleepChart', {
      dates: wellness.map(w => w.date),
      hrv:   wellness.map(w => w.hrv),
      sleep: wellness.map(w => w.sleep)
    });

    // ---- CALENDAR ----
    renderCalendar(activities);

    // ---- HEATMAP ----
    renderHeatmap(heatmap1y);
    document.querySelectorAll('[data-heatmap-toggle]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-heatmap-toggle]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // ---- BESTS ----
    const powerBests = DATA.powerBests(activities);
    const paceBests  = DATA.paceBests(activities);
    if (powerBests.length) buildPowerBestsChart('powerBestsChart', powerBests);
    if (paceBests.length)  buildPaceBestsChart('paceBestsChart', paceBests);
    renderBestsTables(powerBests, paceBests);

    // ---- TABS ----
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.bests-container').forEach(c => c.classList.add('hidden'));
        document.getElementById(tab.dataset.tab).classList.remove('hidden');
      });
    });

    document.getElementById('loading-state').classList.add('hidden');
    document.getElementById('dashboard-content').classList.remove('hidden');

  } catch(err) {
    document.getElementById('loading-state').classList.add('hidden');
    document.getElementById('error-state').classList.remove('hidden');
    document.getElementById('error-msg').textContent = err.message;
    console.error(err);
  }
});

function renderActivityCards(activities) {
  const container = document.getElementById('activity-cards');
  const totalDist = activities.reduce((s,a) => s+(a.distance||0),0)/1000;
  const totalHrs  = activities.reduce((s,a) => s+(a.duration||0),0)/3600;
  document.getElementById('week-summary').textContent =
    `${activities.length} activities · ${totalDist.toFixed(0)} km · ${totalHrs.toFixed(1)} hrs`;

  if (!activities.length) {
    container.innerHTML = '<div style="color:var(--text-muted);font-family:var(--font-mono);font-size:12px;padding:20px">No activities in the last 7 days</div>';
    return;
  }

  container.innerHTML = activities.map(a => {
    const info = getTypeInfo(a.type);
    const isPower = !!a.avg_power;
    const isPace  = !!a.avg_speed && !a.avg_power;
    const paceSecKm = a.avg_speed ? Math.round(1000/a.avg_speed) : null;
    const stat1val = isPower ? `${a.avg_power}W` : isPace ? formatPace(paceSecKm) : '—';
    const stat1lbl = isPower ? 'Avg Power' : isPace ? 'Pace/km' : 'Effort';
    return `
      <a class="activity-card" href="${info.page}">
        <div class="activity-card-type ${info.colorClass}">
          <span class="type-dot ${info.dotClass}"></span>${info.label}
        </div>
        <div class="activity-card-name">${a.name}</div>
        <div class="activity-card-stats">
          <div class="activity-stat"><span class="activity-stat-value">${formatDuration(a.duration)}</span><span class="activity-stat-label">Duration</span></div>
          <div class="activity-stat"><span class="activity-stat-value">${a.distance?(a.distance/1000).toFixed(1):'—'}</span><span class="activity-stat-label">km</span></div>
          <div class="activity-stat"><span class="activity-stat-value">${stat1val}</span><span class="activity-stat-label">${stat1lbl}</span></div>
          <div class="activity-stat"><span class="activity-stat-value">${a.avg_hr||'—'}</span><span class="activity-stat-label">Avg HR</span></div>
        </div>
        <div class="activity-card-footer">
          <span>${a.date}</span>
          <span class="tss-val">TSS ${a.tss}${a.if_val?' · IF '+a.if_val.toFixed(2):''}</span>
        </div>
      </a>`;
  }).join('');
}

function renderCalendar(activities) {
  const wrap = document.getElementById('calendar-wrap');
  const today = new Date();
  const dayNames = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const actByDate = {};
  activities.forEach(a => { if(!actByDate[a.date]) actByDate[a.date]=[]; actByDate[a.date].push(a); });

  // Start from beginning of current week (Monday), go back 4 more weeks = 5 weeks total
  const start = new Date(today);
  const dow = start.getDay();
  start.setDate(start.getDate() - (dow===0?6:dow-1)); // back to Monday of current week
  start.setDate(start.getDate() - 28); // then back 4 more weeks

  let html = `<div class="calendar-month-header">
    <div class="cal-day-header"></div>
    ${dayNames.map(d=>`<div class="cal-day-header">${d}</div>`).join('')}
    <div class="cal-day-header" style="text-align:right;font-size:9px">TSS</div>
  </div>`;

  const cursor = new Date(start);
  for (let w=0; w<5; w++) {
    let weekTSS=0, weekDist=0;
    const days=[];
    for (let d=0; d<7; d++) {
      const ds = cursor.toISOString().split('T')[0];
      const acts = actByDate[ds]||[];
      weekTSS  += acts.reduce((s,a)=>s+(a.tss||0),0);
      weekDist += acts.reduce((s,a)=>s+(a.distance||0),0);
      days.push({ ds, dayNum:cursor.getDate(), acts, isToday:ds===today.toISOString().split('T')[0], inRange:cursor<=today });
      cursor.setDate(cursor.getDate()+1);
    }
    const wkNum = getISOWeekNum(new Date(days[0].ds));
    html += `<div class="calendar-row"><div class="cal-week-num">W${wkNum}</div>`;
    days.forEach(day => {
      const act=day.acts[0];
      const info=act?getTypeInfo(act.type):null;
      html += `<div class="cal-day-cell ${!day.inRange?'empty':''} ${day.acts.length?'has-activity':''} ${day.isToday?'today':''}">
        <div class="cal-date-num">${day.dayNum}</div>
        ${act?`<div class="cal-activity-mini">
          <div class="cal-mini-name ${info?.colorClass||''}">${act.name.substring(0,16)}</div>
          <div class="cal-mini-stats">${formatDuration(act.duration)} · ${act.tss}tss</div>
        </div>`:''}
      </div>`;
    });
    html += `<div class="cal-week-total">
      <span class="cal-week-tss">${weekTSS}</span>
      <span class="cal-week-label">TSS</span>
      <span class="cal-week-dist">${(weekDist/1000).toFixed(0)}km</span>
    </div></div>`;
  }
  wrap.innerHTML = html;
}

function renderHeatmap(cells) {
  const inner = document.getElementById('heatmap-inner');
  if (!inner) return;
  const months=[]; let lastM=-1;
  cells.forEach((c,i)=>{ const m=new Date(c.date).getMonth(); if(m!==lastM){months.push({label:new Date(c.date).toLocaleString('default',{month:'short'}),index:i});lastM=m;} });
  const colW=16;
  let mHtml=`<div class="heatmap-months" style="padding-left:28px">`;
  months.forEach((m,i)=>{ const next=months[i+1]?.index||cells.length; const cols=Math.ceil((next-m.index)/7); mHtml+=`<div class="heatmap-month-label" style="width:${cols*colW}px">${m.label}</div>`; });
  mHtml+='</div>';
  const gHtml=`<div style="display:flex;gap:0">
    <div class="heatmap-days-labels">${['','Mon','','Wed','','Fri',''].map(d=>`<div class="heatmap-day-label">${d}</div>`).join('')}</div>
    <div class="heatmap-grid">${cells.map(c=>`<div class="heatmap-cell" data-level="${c.level}" title="${c.date}${c.tss?' · '+c.tss+' TSS':''}"></div>`).join('')}</div>
  </div>`;
  inner.innerHTML = mHtml+gHtml;
}

function renderBestsTables(powerBests, paceBests) {
  const pg = document.getElementById('power-bests-grid');
  if (pg) pg.innerHTML = powerBests.length
    ? powerBests.map(b=>`<div class="best-row"><span class="best-duration">${b.label}</span><span class="best-value">${b.value}W</span></div>`).join('')
    : '<div style="color:var(--text-muted);font-size:11px;padding:10px;font-family:var(--font-mono)">No cycling data in last 90 days</div>';

  const rg = document.getElementById('pace-bests-grid');
  if (rg) rg.innerHTML = paceBests.length
    ? paceBests.map(b=>{ const spk=(b.totalSec/b.distM)*1000; return `<div class="best-row"><span class="best-duration">${b.label}</span><span class="best-value">${Math.floor(spk/60)}:${String(Math.floor(spk%60)).padStart(2,'0')}/km</span></div>`; }).join('')
    : '<div style="color:var(--text-muted);font-size:11px;padding:10px;font-family:var(--font-mono)">No running data in last 90 days</div>';
}
</script>
</body>
</html>
