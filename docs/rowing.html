<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rowing — Training OS</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">

<link rel="stylesheet" href="assets/css/main.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

</head>
<body>

<div class="app">

<nav class="sidebar">

<div class="sidebar-brand">
<span class="brand-initials">LH</span>
<span class="brand-text">Training<br>OS</span>
</div>

<ul class="nav-links">
<li class="nav-item"><a href="index.html">Overview</a></li>
<li class="nav-item active"><a href="rowing.html">Rowing</a></li>
<li class="nav-item"><a href="cycling.html">Cycling</a></li>
<li class="nav-item"><a href="running.html">Running</a></li>
</ul>

<div class="sidebar-footer">
<div class="sync-status">
<span id="sync-status">Loading...</span>
</div>
</div>

</nav>

<main class="main-content">

<header class="page-header">
<h1 class="page-title">Rowing</h1>
<span class="page-subtitle">Concept2 · Erg Data</span>
</header>


<section class="metrics-row">

<div class="metric-card">
<div class="metric-label">2K BEST</div>
<div class="metric-value" id="best-2k">—</div>
</div>

<div class="metric-card">
<div class="metric-label">5K BEST</div>
<div class="metric-value" id="best-5k">—</div>
</div>

<div class="metric-card">
<div class="metric-label">60 MIN BEST</div>
<div class="metric-value" id="best-60m">—</div>
</div>

<div class="metric-card">
<div class="metric-label">THIS WEEK</div>
<div class="metric-value" id="week-count">—</div>
<div class="metric-sub" id="week-summary">—</div>
</div>

</section>


<section class="section">

<div class="section-header">
<h2>Recent Rowing Sessions</h2>
<span class="section-meta">Last 30 days</span>
</div>

<div class="activity-cards" id="recent-rows">
Loading rowing sessions...
</div>

</section>


<section class="charts-row">

<div class="chart-card">
<h3>Pace Trend</h3>
<canvas id="paceChart"></canvas>
</div>

<div class="chart-card">
<h3>Weekly Volume</h3>
<canvas id="volumeChart"></canvas>
</div>

</section>

</main>

</div>


<script src="assets/js/data-loader.js"></script>
<script src="assets/js/charts.js"></script>


<script>
document.addEventListener("DOMContentLoaded", async () => {

try {

const { activities } = await DATA.loadAll();

const rows = activities.filter(a =>
(a.type || '').toLowerCase().includes('row')
|| (a.name || '').toLowerCase().includes('row')
|| (a.source || '').toLowerCase().includes('concept2')
);

const syncStatus = document.getElementById('sync-status');

if(rows.length > 0)
{
syncStatus.textContent = "✅ ErgData Connected";
syncStatus.style.color = "var(--green)";
}
else
{
syncStatus.textContent = "No rowing data";
}


// ---------- helpers ----------

function formatTime(seconds)
{
if(!seconds) return "—";

const m = Math.floor(seconds/60);
const s = Math.floor(seconds%60);

return `${m}:${s.toString().padStart(2,'0')}`;
}


// ---------- best 2k ----------

const best2k =
rows
.filter(a => a.distance >= 1900 && a.distance <= 2100)
.sort((a,b)=>a.duration-b.duration)[0];

if(best2k)
{
document.getElementById("best-2k").textContent =
formatTime(best2k.duration);
}


// ---------- best 5k ----------

const best5k =
rows
.filter(a => a.distance >= 4900 && a.distance <= 5100)
.sort((a,b)=>a.duration-b.duration)[0];

if(best5k)
{
document.getElementById("best-5k").textContent =
formatTime(best5k.duration);
}


// ---------- best 60 ----------

const best60 =
rows
.filter(a => a.duration >= 3500 && a.duration <= 3900)
.sort((a,b)=>b.distance-a.distance)[0];

if(best60)
{
document.getElementById("best-60m").textContent =
(best60.distance/1000).toFixed(1)+" km";
}


// ---------- week stats ----------

const cutoff =
new Date(Date.now()-7*864e5)
.toISOString()
.split('T')[0];

const weekRows =
rows.filter(a=>a.date>=cutoff);

document.getElementById("week-count").textContent =
weekRows.length;

const weekKm =
weekRows.reduce((s,a)=>s+(a.distance||0),0)/1000;

document.getElementById("week-summary").textContent =
`${weekKm.toFixed(1)} km`;


// ---------- recent ----------

const recent =
rows
.sort((a,b)=>b.date.localeCompare(a.date))
.slice(0,10);

document.getElementById("recent-rows").innerHTML =
recent.map(a=>`

<div class="activity-card">

<div class="activity-card-name">
${a.name || "Rowing"}
</div>

<div class="activity-card-stats">

<div>
${formatTime(a.duration)}
</div>

<div>
${(a.distance/1000).toFixed(1)} km
</div>

<div>
${a.date}
</div>

</div>

</div>

`).join("");


// ---------- charts ----------

if(typeof renderPaceChart==="function")
renderPaceChart(activities);

if(typeof renderVolumeChart==="function")
renderVolumeChart(activities);


}
catch(e)
{
console.error(e);
}

});
</script>


</body>
</html>
