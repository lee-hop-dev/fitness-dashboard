<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running — Fitness Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<div class="app">

  <nav class="sidebar">
    <div class="sidebar-brand">
      <span class="brand-initials">LH</span>
      <span class="brand-text">Training<br>OS</span>
    </div>
    <ul class="nav-links">
      <li class="nav-item"><a href="index.html"><span class="nav-icon">◈</span><span>Overview</span></a></li>
      <li class="nav-item"><a href="cycling.html"><span class="nav-icon">⬡</span><span>Cycling</span></a></li>
      <li class="nav-item active"><a href="running.html"><span class="nav-icon">▷</span><span>Running</span></a></li>
      <li class="nav-item"><a href="rowing.html"><span class="nav-icon">⊕</span><span>Rowing</span></a></li>
      <li class="nav-item"><a href="cardio.html"><span class="nav-icon">◎</span><span>Cardio</span></a></li>
      <li class="nav-item"><a href="other.html"><span class="nav-icon">○</span><span>Other</span></a></li>
    </ul>
    <div class="sidebar-footer">
      <div class="sync-status">
        <span class="sync-dot"></span>
        <span class="sync-text">Synced 6:00 AM</span>
      </div>
    </div>
  </nav>

  <main class="main-content">

    <header class="page-header">
      <div class="header-left">
        <h1 class="page-title">Running</h1>
        <span class="page-subtitle">Road · Trail · Treadmill</span>
      </div>
      <div class="header-right">
        <div class="year-totals">
          <div class="year-stat">
            <span class="year-stat-value" id="ru-distance">—</span>
            <span class="year-stat-label">km YTD</span>
          </div>
          <div class="year-stat">
            <span class="year-stat-value" id="ru-runs">—</span>
            <span class="year-stat-label">runs YTD</span>
          </div>
          <div class="year-stat">
            <span class="year-stat-value" id="ru-elevation">—</span>
            <span class="year-stat-label">m climb YTD</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Metric cards -->
    <section class="metrics-row" style="grid-template-columns: repeat(4,1fr)">
      <div class="metric-card form">
        <div class="metric-label">5K BEST</div>
        <div class="metric-value" style="color:var(--green)">20:45</div>
        <div class="metric-delta neutral">4:09/km</div>
        <div class="metric-bar"><div class="metric-bar-fill" style="width:72%;background:var(--green)"></div></div>
        <div class="metric-sub">90-day best</div>
      </div>
      <div class="metric-card fitness">
        <div class="metric-label">10K BEST</div>
        <div class="metric-value" style="color:var(--accent)">43:00</div>
        <div class="metric-delta neutral">4:18/km</div>
        <div class="metric-bar"><div class="metric-bar-fill" style="width:65%"></div></div>
        <div class="metric-sub">90-day best</div>
      </div>
      <div class="metric-card hrv">
        <div class="metric-label">THRESHOLD PACE</div>
        <div class="metric-value" style="color:var(--purple)">4:25</div>
        <div class="metric-delta neutral">per km</div>
        <div class="metric-bar"><div class="metric-bar-fill" style="width:58%;background:var(--purple)"></div></div>
        <div class="metric-sub">Current estimate</div>
      </div>
      <div class="metric-card sleep">
        <div class="metric-label">THIS WEEK</div>
        <div class="metric-value" style="color:var(--yellow)">2</div>
        <div class="metric-delta neutral">runs · 16.9 km</div>
        <div class="metric-bar"><div class="metric-bar-fill" style="width:38%;background:var(--yellow)"></div></div>
        <div class="metric-sub">1.4 hrs running</div>
      </div>
    </section>

    <!-- Pace curve + Trend -->
    <section class="charts-row" style="grid-template-columns: 2fr 1fr">
      <div class="chart-card">
        <div class="chart-header">
          <h3>Pace Curve · 90 Days</h3>
          <div class="chart-legend">
            <span class="legend-item run">Pace</span>
            <span style="font-size:10px;color:var(--red);font-family:var(--font-mono)">HR</span>
          </div>
        </div>
        <div class="cp-chart-wrap"><canvas id="paceCurveChart"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><h3>Pace Trend · 42 Days</h3></div>
        <div class="chart-wrap"><canvas id="paceTrendChart"></canvas></div>
      </div>
    </section>

    <!-- Recent runs -->
    <section class="section">
      <div class="section-header">
        <h2>Last 14 Days</h2>
        <span class="section-meta" id="ru-week-meta">Loading...</span>
      </div>
      <div class="activity-cards" id="ru-activity-cards"></div>
    </section>

    <!-- Strava segments -->
    <section class="section">
      <div class="section-header">
        <h2>Strava Segments</h2>
        <span class="section-meta">Personal bests & rankings</span>
      </div>
      <div class="segment-list" id="ru-segments"></div>
    </section>

  </main>
</div>

<script src="assets/js/config.js"></script>
<script src="assets/js/api.js"></script>
<script src="assets/js/charts.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const D = FITNESS_DATA;

  document.getElementById('ru-distance').textContent = '286';
  document.getElementById('ru-runs').textContent = '28';
  document.getElementById('ru-elevation').textContent = '2,140';

  // Pace curve
  buildPaceBestsChart('paceCurveChart', D.pace_bests);

  // Pace trend (mock 42-day average pace)
  const paceDates = D.wellness_trend.dates;
  const paceValues = [285, 292, 278, 310, 275, 268, 282, 271, 265, 270];
  buildWellnessChart('paceTrendChart', paceDates, paceValues, '#00ff87', 'Avg Pace');

  // Filter running activities
  const ruActivities = D.recent_activities.filter(a => a.type === 'VirtualRun' || a.type === 'Run');

  const totalDist = ruActivities.reduce((s, a) => s + (a.distance || 0), 0) / 1000;
  const totalHrs  = ruActivities.reduce((s, a) => s + (a.duration || 0), 0) / 3600;
  document.getElementById('ru-week-meta').textContent =
    `${ruActivities.length} runs · ${totalDist.toFixed(1)} km · ${totalHrs.toFixed(1)} hrs`;

  const container = document.getElementById('ru-activity-cards');
  container.innerHTML = ruActivities.map(a => `
    <div class="activity-card">
      <div class="activity-card-type type-run">
        <span class="type-dot dot-run"></span>
        Running
      </div>
      <div class="activity-card-name">${a.name}</div>
      <div class="activity-card-stats">
        <div class="activity-stat">
          <span class="activity-stat-value">${formatDuration(a.duration)}</span>
          <span class="activity-stat-label">Duration</span>
        </div>
        <div class="activity-stat">
          <span class="activity-stat-value">${(a.distance/1000).toFixed(1)}</span>
          <span class="activity-stat-label">km</span>
        </div>
        <div class="activity-stat">
          <span class="activity-stat-value">${formatPace(a.avg_pace)}</span>
          <span class="activity-stat-label">Pace/km</span>
        </div>
        <div class="activity-stat">
          <span class="activity-stat-value">${a.avg_hr}</span>
          <span class="activity-stat-label">Avg HR</span>
        </div>
      </div>
      <div class="activity-card-date">${a.date} · TSS ${a.tss}</div>
    </div>`
  ).join('');

  // Segments
  const segList = document.getElementById('ru-segments');
  segList.innerHTML = D.segments.running.map(s => `
    <div class="segment-row">
      <div>
        <div class="segment-name">${s.name}</div>
        <div style="font-size:11px;color:var(--text-muted);font-family:var(--font-mono);margin-top:2px">${(s.distance/1000).toFixed(1)} km</div>
      </div>
      <div class="segment-stat">
        <span class="segment-stat-value">${s.time}</span>
        <span class="segment-stat-label">Time</span>
      </div>
      <div class="segment-stat">
        <span class="segment-stat-value">${s.pace}</span>
        <span class="segment-stat-label">Avg Pace</span>
      </div>
      <div class="segment-stat">
        <span class="segment-stat-value">#${s.rank}</span>
        <span class="segment-stat-label">Rank</span>
      </div>
      ${s.pr ? '<span class="pr-badge">PR</span>' : '<div></div>'}
    </div>`
  ).join('');
});
</script>
</body>
</html>
