{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Fitness Dashboard Data Schema",
  "description": "Standardized format for fitness activities across all sources",
  
  "definitions": {
    "activity": {
      "type": "object",
      "required": ["id", "source", "type", "start_time", "duration"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier (source-specific)"
        },
        "source": {
          "type": "string",
          "enum": ["intervals_icu", "strava", "concept2", "zwift"],
          "description": "Data source"
        },
        "type": {
          "type": "string",
          "enum": ["Ride", "VirtualRide", "Run", "VirtualRun", "Rowing", "Walk", "Swim", "Workout", "WeightTraining"],
          "description": "Activity type"
        },
        "start_time": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp"
        },
        "duration": {
          "type": "number",
          "description": "Duration in seconds"
        },
        "distance": {
          "type": "number",
          "description": "Distance in meters"
        },
        "elevation_gain": {
          "type": "number",
          "description": "Elevation gain in meters"
        },
        "name": {
          "type": "string",
          "description": "Activity name/title"
        },
        "description": {
          "type": "string",
          "description": "Activity notes/description"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "avg_heart_rate": {"type": "number"},
            "max_heart_rate": {"type": "number"},
            "avg_power": {"type": "number"},
            "normalized_power": {"type": "number"},
            "max_power": {"type": "number"},
            "avg_cadence": {"type": "number"},
            "avg_speed": {"type": "number"},
            "max_speed": {"type": "number"},
            "avg_pace": {"type": "number"},
            "calories": {"type": "number"},
            "tss": {"type": "number", "description": "Training Stress Score"},
            "intensity_factor": {"type": "number"},
            "variability_index": {"type": "number"}
          }
        },
        "zones": {
          "type": "object",
          "properties": {
            "heart_rate_zones": {
              "type": "array",
              "items": {"type": "number"},
              "description": "Time in seconds per zone"
            },
            "power_zones": {
              "type": "array",
              "items": {"type": "number"},
              "description": "Time in seconds per zone"
            }
          }
        },
        "splits": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "distance": {"type": "number"},
              "time": {"type": "number"},
              "elevation_gain": {"type": "number"},
              "avg_speed": {"type": "number"},
              "avg_heart_rate": {"type": "number"},
              "avg_power": {"type": "number"}
            }
          }
        },
        "gear": {
          "type": "object",
          "properties": {
            "id": {"type": "string"},
            "name": {"type": "string"},
            "type": {"type": "string"}
          }
        },
        "location": {
          "type": "object",
          "properties": {
            "start_latitude": {"type": "number"},
            "start_longitude": {"type": "number"},
            "end_latitude": {"type": "number"},
            "end_longitude": {"type": "number"}
          }
        },
        "raw_data": {
          "type": "object",
          "description": "Source-specific raw data for reference"
        }
      }
    },
    
    "wellness": {
      "type": "object",
      "required": ["date"],
      "properties": {
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date of wellness measurement"
        },
        "sleep_time": {
          "type": "number",
          "description": "Hours of sleep"
        },
        "sleep_quality": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Sleep quality rating"
        },
        "hrv": {
          "type": "number",
          "description": "Heart Rate Variability (ms)"
        },
        "resting_hr": {
          "type": "number",
          "description": "Resting heart rate (bpm)"
        },
        "weight": {
          "type": "number",
          "description": "Body weight (kg)"
        },
        "fatigue": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Fatigue level"
        },
        "mood": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Mood rating"
        },
        "soreness": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Muscle soreness"
        },
        "stress": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Stress level"
        },
        "spo2": {
          "type": "number",
          "description": "Blood oxygen saturation (%)"
        },
        "notes": {
          "type": "string",
          "description": "Daily notes"
        }
      }
    },
    
    "segment_effort": {
      "type": "object",
      "required": ["segment_id", "activity_id", "elapsed_time"],
      "properties": {
        "segment_id": {"type": "string"},
        "segment_name": {"type": "string"},
        "activity_id": {"type": "string"},
        "elapsed_time": {"type": "number", "description": "Seconds"},
        "distance": {"type": "number", "description": "Meters"},
        "avg_power": {"type": "number"},
        "avg_heart_rate": {"type": "number"},
        "pr_rank": {"type": "integer", "description": "Personal record rank"},
        "kom_rank": {"type": "integer", "description": "Overall leaderboard rank"},
        "start_time": {"type": "string", "format": "date-time"}
      }
    },
    
    "race_result": {
      "type": "object",
      "required": ["race_id", "date", "position"],
      "properties": {
        "race_id": {"type": "string"},
        "race_name": {"type": "string"},
        "date": {"type": "string", "format": "date-time"},
        "series": {"type": "string", "description": "e.g., WTRL, ZRL"},
        "category": {"type": "string", "description": "e.g., A, B, C, D"},
        "position": {"type": "integer"},
        "total_racers": {"type": "integer"},
        "duration": {"type": "number", "description": "Seconds"},
        "distance": {"type": "number", "description": "Meters"},
        "avg_power": {"type": "number"},
        "normalized_power": {"type": "number"},
        "avg_heart_rate": {"type": "number"},
        "w_per_kg": {"type": "number"},
        "youtube_url": {"type": "string", "format": "uri"},
        "zwift_activity_id": {"type": "string"}
      }
    },
    
    "training_load": {
      "type": "object",
      "required": ["date"],
      "properties": {
        "date": {"type": "string", "format": "date"},
        "ctl": {"type": "number", "description": "Chronic Training Load (Fitness)"},
        "atl": {"type": "number", "description": "Acute Training Load (Fatigue)"},
        "tsb": {"type": "number", "description": "Training Stress Balance (Form)"},
        "daily_tss": {"type": "number", "description": "Daily Training Stress Score"}
      }
    }
  },
  
  "type": "object",
  "properties": {
    "activities": {
      "type": "array",
      "items": {"$ref": "#/definitions/activity"}
    },
    "wellness": {
      "type": "array",
      "items": {"$ref": "#/definitions/wellness"}
    },
    "segments": {
      "type": "array",
      "items": {"$ref": "#/definitions/segment_effort"}
    },
    "races": {
      "type": "array",
      "items": {"$ref": "#/definitions/race_result"}
    },
    "training_load": {
      "type": "array",
      "items": {"$ref": "#/definitions/training_load"}
    },
    "last_updated": {
      "type": "string",
      "format": "date-time"
    }
  }
}
